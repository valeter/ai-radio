#!/usr/bin/liquidsoap

# Logging
log.file.path.set("/var/log/liquidsoap/ai-radio.log")

# If something goes wrong, we'll play this
security = single("/music/example/white_noise.mp3")

jingles = playlist(reload_mode="watch", mode="random", "/music/playlists/jingles.m3u")
morning = playlist(reload_mode="watch", mode="random", "/music/playlists/morning.m3u")
day = playlist(reload_mode="watch", mode="random", "/music/playlists/day.m3u")
night = playlist(reload_mode="watch", mode="random", "/music/playlists/night.m3u")

news = playlist(reload_mode="watch", "/music/playlists/news.m3u")

radio = switch([({6h-11h}, morning), ({11h-18h}, day), ({18h-24h}, night), ({0h-6h}, night)])
radio = random(weights=[1, 5], [jingles, radio])
radio = switch(track_sensitive=false, [({ 0m-2m or 10m-12m or 20m-22m or 30m-32m or 40m-42m or 50m-52m }, news), ({ true }, radio)])

radio = fallback(track_sensitive=false, [radio, mksafe(security)])

# Stream it out
output.icecast(%mp3(bitrate=128, samplerate=22050, stereo=true), host = "localhost", port = {{ICECAST_PORT}}, password = "{{ICECAST_PASSWORD}}", mount = "/", radio)